---
import BaseLayout from '../layouts/BaseLayout.astro';
import PathwayStep from '../components/PathwayStep.astro';
import { getCollection } from 'astro:content';
import { render } from 'astro:content';

const pathwaySteps = (await getCollection('pathway')).sort((a, b) => a.data.step - b.data.step);
const alternatives = (await getCollection('alternatives')).sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));
---
<BaseLayout
  title="Getting Started"
  description="A step-by-step guide to accessing Medicare-funded mental health support in Australia â€” from booking a GP to finding a psychologist."
>
  <!-- Hero -->
  <section class="bg-brand-light">
    <div class="max-w-3xl mx-auto px-4 py-12">
      <h1 class="text-3xl md:text-4xl font-bold text-brand-blue mb-4">Getting Started with Mental Health Support</h1>
      <p class="text-lg text-gray-600">
        A clear, step-by-step guide to accessing Medicare-funded psychology sessions in Australia. Click each step to learn more.
      </p>
    </div>
  </section>

  <!-- Pathway Steps -->
  <section class="max-w-3xl mx-auto px-4 py-12">
    <h2 class="sr-only">The Medicare pathway</h2>
    {pathwaySteps.map(async (step, index) => {
      const { Content } = await render(step);
      return (
        <PathwayStep
          step={step.data.step}
          title={step.data.title}
          summary={step.data.summary}
          isLast={index === pathwaySteps.length - 1}
        >
          <Content />
        </PathwayStep>
      );
    })}
  </section>

  <!-- Alternative Pathways -->
  <section class="bg-brand-light">
    <div class="max-w-3xl mx-auto px-4 py-12">
      <h2 class="text-2xl font-bold text-brand-blue mb-2">Other Ways to Get Support</h2>
      <p class="text-gray-600 mb-8">The Medicare pathway isn't your only option. Here are other ways to access mental health support.</p>

      <div class="space-y-4">
        {alternatives.map(async (alt) => {
          const { Content } = await render(alt);
          return (
            <details class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
              <summary class="px-6 py-4 text-lg font-semibold text-brand-blue hover:bg-gray-50 transition-colors">
                {alt.data.title}
              </summary>
              <div class="px-6 pb-6 prose prose-sm max-w-none text-gray-700">
                <p class="text-gray-500 text-sm italic mt-0">{alt.data.summary}</p>
                <Content />
              </div>
            </details>
          );
        })}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="max-w-3xl mx-auto px-4 py-12 text-center">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">Not sure what type of practitioner you need?</h2>
    <a href="/practitioners/" class="inline-block bg-brand-blue text-white px-6 py-3 rounded-lg font-medium hover:bg-brand-blue/90 transition-colors">
      Compare Practitioners
    </a>
  </section>
</BaseLayout>
