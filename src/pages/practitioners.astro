---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

const practitioners = (await getCollection('practitioners')).sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));
---
<BaseLayout
  title="Compare Practitioners"
  description="Understand the difference between psychologists, psychiatrists, counsellors, and psychotherapists â€” including costs, Medicare rebates, and referral requirements."
>
  <!-- Hero -->
  <section class="bg-brand-light">
    <div class="max-w-5xl mx-auto px-4 py-12">
      <h1 class="text-3xl md:text-4xl font-bold text-brand-blue mb-4">Compare Mental Health Practitioners</h1>
      <p class="text-lg text-gray-600">
        Not sure who to see? Here's a clear comparison of the main types of mental health professionals in Australia.
      </p>
    </div>
  </section>

  <!-- Quick Comparison Table -->
  <section class="max-w-5xl mx-auto px-4 py-12">
    <h2 class="text-2xl font-bold text-brand-blue mb-6">Quick Comparison</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left border-collapse">
        <thead>
          <tr class="border-b-2 border-brand-blue">
            <th class="py-3 px-4 font-semibold text-brand-blue"></th>
            <th class="py-3 px-4 font-semibold text-brand-blue">Typical Cost</th>
            <th class="py-3 px-4 font-semibold text-brand-blue">Medicare Rebate</th>
            <th class="py-3 px-4 font-semibold text-brand-blue">Referral Needed?</th>
            <th class="py-3 px-4 font-semibold text-brand-blue">Typical Wait</th>
          </tr>
        </thead>
        <tbody>
          {practitioners.map((p, i) => (
            <tr class:list={[i % 2 === 0 ? 'bg-white' : 'bg-gray-50', 'border-b border-gray-200']}>
              <td class="py-3 px-4 font-semibold text-gray-800">{p.data.title}</td>
              <td class="py-3 px-4 text-gray-600">{p.data.cost}</td>
              <td class="py-3 px-4 text-gray-600">{p.data.rebate}</td>
              <td class="py-3 px-4">
                {p.data.referralRequired ? (
                  <span class="text-brand-orange font-medium">Yes</span>
                ) : (
                  <span class="text-brand-green font-medium">No</span>
                )}
              </td>
              <td class="py-3 px-4 text-gray-600">{p.data.waitTime}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Detailed Cards -->
  <section class="bg-brand-light">
    <div class="max-w-5xl mx-auto px-4 py-12">
      <h2 class="text-2xl font-bold text-brand-blue mb-8">Detailed Breakdown</h2>
      <div class="grid md:grid-cols-2 gap-6">
        {practitioners.map(async (p) => {
          const { Content } = await render(p);
          return (
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
              <div class="px-6 py-4 border-b border-gray-100">
                <h3 class="text-xl font-bold text-brand-blue">{p.data.title}</h3>
                <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                  <div>
                    <span class="text-gray-500">Cost:</span>
                    <span class="ml-1 text-gray-800">{p.data.cost}</span>
                  </div>
                  <div>
                    <span class="text-gray-500">Rebate:</span>
                    <span class="ml-1 text-gray-800">{p.data.rebate}</span>
                  </div>
                  <div>
                    <span class="text-gray-500">Referral:</span>
                    <span class:list={['ml-1 font-medium', p.data.referralRequired ? 'text-brand-orange' : 'text-brand-green']}>
                      {p.data.referralRequired ? 'Required' : 'Not required'}
                    </span>
                  </div>
                  <div>
                    <span class="text-gray-500">Wait:</span>
                    <span class="ml-1 text-gray-800">{p.data.waitTime}</span>
                  </div>
                </div>
              </div>
              <div class="px-6 py-4 prose prose-sm max-w-none text-gray-700">
                <Content />
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="max-w-3xl mx-auto px-4 py-12 text-center">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">Want to estimate your out-of-pocket costs?</h2>
    <a href="/calculator/" class="inline-block bg-brand-green text-white px-6 py-3 rounded-lg font-medium hover:bg-brand-green/90 transition-colors">
      Use the Cost Calculator
    </a>
  </section>
</BaseLayout>
